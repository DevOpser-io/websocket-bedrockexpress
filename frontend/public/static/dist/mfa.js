(()=>{"use strict";(()=>{class e{constructor(e){this.container=e,this.messages=[],this.render()}addMessage(e,t="info",n=5e3){const o=Date.now()+Math.random(),s={id:o,message:e,type:t};return this.messages.push(s),this.render(),n>0&&setTimeout((()=>this.removeMessage(o)),n),o}removeMessage(e){const t=this.messages.findIndex((t=>t.id===e));-1!==t&&(this.messages.splice(t,1),this.render())}clear(){this.messages=[],this.render()}render(){this.container.innerHTML="",0!==this.messages.length?(this.container.style.display="block",this.messages.forEach((e=>{const t=document.createElement("div");t.className=`status-message status-message-${e.type}`,t.textContent=e.message,this.container.appendChild(t)}))):this.container.style.display="none"}}function t(){const t=document.querySelectorAll(".email-code-form");t.length?t.forEach((t=>{console.log("Setting up email form:",t);const o=t.querySelector('button[type="submit"]'),s=t.closest(".email-info")?.querySelector(".status-messages");if(!o||!s)return void console.log("Missing required elements for email verification",{button:!!o,statusContainer:!!s,formParent:t.closest(".email-info")});const a=new e(s);let i=!1;t.addEventListener("submit",(async function(e){if(e.preventDefault(),e.stopPropagation(),!i&&!o.disabled)try{console.log("Sending code request"),i=!0,o.disabled=!0,o.textContent=o.dataset.loadingText||"Sending...",a.clear();const e=document.querySelector('meta[name="csrf-token"]')?.content;if(!e)throw new Error("CSRF token not found");const s=new FormData(t),c=await fetch(t.action,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRFToken":e},body:s}),r=await c.json();if(console.log("Response:",r),429===c.status){const e=r.message.match(/\d+/),t=e?parseInt(e[0]):120;a.addMessage(r.message,"warning",1e3*t),n(o,t)}else 200===c.status&&r.success?(a.addMessage(r.message,"success",5e3),n(o,120)):(a.addMessage(r.message,"error",5e3),o.disabled=!1,o.textContent=o.dataset.defaultText||"Send Code")}catch(e){console.error("Error:",e),a.addMessage("An error occurred. Please try again.","error",5e3),o.disabled=!1,o.textContent=o.dataset.defaultText||"Send Code"}finally{o.hasAttribute("data-countdown")||(i=!1)}})),o.dataset.defaultText=o.textContent})):console.log("No email verification forms found")}function n(e,t){e.setAttribute("data-countdown","true"),e.disabled=!0,e._countdownInterval&&clearInterval(e._countdownInterval);const n=setInterval((()=>{e.textContent=`Wait ${t}s`,--t<0&&(clearInterval(n),e.removeAttribute("data-countdown"),e._countdownInterval=null,e.disabled=!1,e.textContent="Send Code")}),1e3);e._countdownInterval=n}document.addEventListener("DOMContentLoaded",(function(){console.log("MFA module loaded"),function(){if(!document.querySelector(".mfa-container"))return void console.log("No MFA container found on this page");console.log("Initializing MFA setup");const e=document.querySelector(".js-toggle-key"),n=document.querySelector(".secret-key");e&&n&&(console.log("Setting up toggle key handler"),e.addEventListener("click",(()=>{n.classList.toggle("hidden"),e.textContent=n.classList.contains("hidden")?"Can't scan? Enter key manually":"Hide manual key"}))),function(){const e=document.querySelectorAll('input[name="mfa_method"]'),t=document.querySelector(".authenticator-section"),n=document.querySelector(".email-section"),o=document.querySelector(".selected-method");function s(){const e=document.querySelector('input[name="mfa_method"]:checked').value;console.log(`Switching to method: ${e}`),t.classList.toggle("hidden","authenticator"!==e),t.classList.toggle("active","authenticator"===e),n.classList.toggle("hidden","authenticator"===e),n.classList.toggle("active","authenticator"!==e),o.value=e}e.length&&t&&n&&o?(console.log("Setting up method selection handlers"),e.forEach((e=>{e.addEventListener("change",s)})),s()):console.log("Missing required elements for method selection")}(),t()}(),document.querySelector(".mfa-verify-page")?(console.log("Initializing MFA verify page"),function(){const e=document.querySelectorAll(".tab-button"),t=document.querySelectorAll(".tab-content");if(!e.length||!t.length)return void console.log("No tab elements found");console.log("Setting up tab handlers");const n=new URLSearchParams(window.location.search).get("active_tab")||e[0].getAttribute("data-tab");function o(n){console.log(`Activating tab: ${n}`),e.forEach((e=>{const t=e.getAttribute("data-tab")===n;e.classList.toggle("active",t),e.setAttribute("aria-selected",t)})),t.forEach((e=>{const t=e.id===`${n}-tab`;e.classList.toggle("active",t),e.classList.toggle("hidden",!t),e.setAttribute("aria-hidden",!t)}));const o=new URL(window.location.href);o.searchParams.set("active_tab",n),window.history.replaceState({},"",o)}e.forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault(),o(e.getAttribute("data-tab"))}))})),o(n)}(),t()):console.log("No MFA verify page found")}))})()})();